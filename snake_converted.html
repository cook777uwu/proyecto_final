<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Snake Game — convertido desde Java</title>
<style>
  body { display:flex; align-items:center; justify-content:center; height:100vh; margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; background:#111; color:#eee; }
  .container { text-align:center; }
  canvas { background:#000; image-rendering: pixelated; border:4px solid #222; display:block; margin:0 auto; }
  .info { margin-top:10px; display:flex; gap:12px; justify-content:center; align-items:center; }
  button { padding:8px 12px; border-radius:8px; border:none; background:#06f; color:white; cursor:pointer; }
  button:active { transform:translateY(1px); }
  .legend { font-size:14px; opacity:0.9; }
  .score { font-weight:700; font-size:16px; }
  .hint { font-size:13px; opacity:0.8; }
</style>
</head>
<body>
<div class="container">
  <h2>Snake (convertido de Java a HTML5)</h2>
  <canvas id="game" width="300" height="300"></canvas>
  <div class="info">
    <div class="score">Puntos: <span id="score">0</span></div>
    <button id="startBtn">Iniciar / Reiniciar</button>
    <div class="legend hint">Usa las flechas ↑↓←→ o WASD</div>
  </div>
  <div class="hint" style="margin-top:8px">Tamaño tablero: 300×300 — Unidad: 10 — Velocidad: 140 ms</div>
</div>

<script>
(() => {
  // Parámetros tomados del applet Java original
  const BOARD_WIDTH = 300;
  const BOARD_HEIGHT = 300;
  const UNIT_SIZE = 10;
  const DELAY = 140; // ms

  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const scoreEl = document.getElementById('score');
  const startBtn = document.getElementById('startBtn');

  const maxUnits = (BOARD_WIDTH * BOARD_HEIGHT) / (UNIT_SIZE * UNIT_SIZE);

  let x = new Array(maxUnits);
  let y = new Array(maxUnits);
  let bodyParts = 6;     // longitud inicial (parecido al applet original)
  let applesEaten = 0;
  let appleX = 0;
  let appleY = 0;
  let direction = 'R'; // 'U', 'D', 'L', 'R'
  let running = false;
  let timerId = null;

  // Inicializa la serpiente en el centro, horizontal
  function initSnake() {
    bodyParts = 6;
    applesEaten = 0;
    direction = 'R';
    for (let i = 0; i < bodyParts; i++) {
      x[i] = (BOARD_WIDTH / 2) - i * UNIT_SIZE;
      y[i] = BOARD_HEIGHT / 2;
    }
  }

  function placeApple() {
    // asegura que appleX/Y estén alineados a la cuadrícula
    appleX = Math.floor(Math.random() * (BOARD_WIDTH / UNIT_SIZE)) * UNIT_SIZE;
    appleY = Math.floor(Math.random() * (BOARD_HEIGHT / UNIT_SIZE)) * UNIT_SIZE;
    // Evitar colocar la manzana sobre la serpiente
    for (let i = 0; i < bodyParts; i++) {
      if (x[i] === appleX && y[i] === appleY) {
        // si coincide, reintentar
        return placeApple();
      }
    }
  }

  function startGame() {
    initSnake();
    placeApple();
    running = true;
    scoreEl.textContent = applesEaten;
    if (timerId) clearInterval(timerId);
    timerId = setInterval(gameLoop, DELAY);
    draw();
  }

  function gameLoop() {
    if (!running) return;
    move();
    checkApple();
    checkCollisions();
    draw();
  }

  function move() {
    // mueve el cuerpo
    for (let i = bodyParts; i > 0; i--) {
      x[i] = x[i - 1];
      y[i] = y[i - 1];
    }
    // mueve la cabeza según la dirección
    if (direction === 'U') y[0] = y[0] - UNIT_SIZE;
    else if (direction === 'D') y[0] = y[0] + UNIT_SIZE;
    else if (direction === 'L') x[0] = x[0] - UNIT_SIZE;
    else if (direction === 'R') x[0] = x[0] + UNIT_SIZE;
  }

  function checkApple() {
    if (x[0] === appleX && y[0] === appleY) {
      bodyParts++;
      applesEaten++;
      scoreEl.textContent = applesEaten;
      placeApple();
    }
  }

  function checkCollisions() {
    // cabeza colisiona con el cuerpo
    for (let i = bodyParts; i > 0; i--) {
      if (i > 4 && x[0] === x[i] && y[0] === y[i]) {
        gameOver();
        return;
      }
    }
    // colisiones con bordes (comportamiento tradicional)
    if (x[0] < 0 || x[0] >= BOARD_WIDTH || y[0] < 0 || y[0] >= BOARD_HEIGHT) {
      gameOver();
      return;
    }
  }

  function gameOver() {
    running = false;
    clearInterval(timerId);
    drawGameOver();
  }

  function drawGrid() {
    // opcional: dibujar la cuadrícula sutil
    ctx.strokeStyle = "rgba(255,255,255,0.03)";
    for (let gx = 0; gx <= BOARD_WIDTH; gx += UNIT_SIZE) {
      ctx.beginPath();
      ctx.moveTo(gx + 0.5, 0);
      ctx.lineTo(gx + 0.5, BOARD_HEIGHT);
      ctx.stroke();
    }
  }

  function draw() {
    // fondo
    ctx.fillStyle = "#000";
    ctx.fillRect(0, 0, BOARD_WIDTH, BOARD_HEIGHT);

    // drawGrid(); // descomenta si quieres ver la cuadricula

    // dibujar la manzana
    ctx.fillStyle = "#ff0000";
    ctx.fillRect(appleX, appleY, UNIT_SIZE, UNIT_SIZE);

    // dibujar la serpiente
    for (let i = 0; i < bodyParts; i++) {
      if (i === 0) {
        // cabeza
        ctx.fillStyle = "#00ff00";
        ctx.fillRect(x[i], y[i], UNIT_SIZE, UNIT_SIZE);
      } else {
        // cuerpo con degradado simple
        ctx.fillStyle = i % 2 === 0 ? "#66ff66" : "#33cc33";
        ctx.fillRect(x[i], y[i], UNIT_SIZE, UNIT_SIZE);
      }
    }
  }

  function drawGameOver() {
    // deja el último frame y muestra overlay
    ctx.fillStyle = "rgba(0,0,0,0.6)";
    ctx.fillRect(0, 0, BOARD_WIDTH, BOARD_HEIGHT);
    ctx.fillStyle = "#fff";
    ctx.font = "20px sans-serif";
    ctx.textAlign = "center";
    ctx.fillText("GAME OVER", BOARD_WIDTH / 2, BOARD_HEIGHT / 2 - 10);
    ctx.font = "14px sans-serif";
    ctx.fillText("Puntos: " + applesEaten, BOARD_WIDTH / 2, BOARD_HEIGHT / 2 + 16);
    ctx.font = "12px sans-serif";
    ctx.fillText("Pulsa Iniciar / Reiniciar para jugar otra vez", BOARD_WIDTH / 2, BOARD_HEIGHT / 2 + 40);
  }

  // control de teclado (también WASD)
  window.addEventListener('keydown', function(e) {
    const key = e.key;
    if (!running && (key === 'ArrowUp' || key === 'ArrowDown' || key === 'ArrowLeft' || key === 'ArrowRight' || key === 'w' || key === 'a' || key === 's' || key === 'd')) {
      // si no está corriendo, iniciar al presionar dirección
      startGame();
    }
    if ((key === 'ArrowLeft' || key === 'a') && direction !== 'R') {
      direction = 'L';
    } else if ((key === 'ArrowRight' || key === 'd') && direction !== 'L') {
      direction = 'R';
    } else if ((key === 'ArrowUp' || key === 'w') && direction !== 'D') {
      direction = 'U';
    } else if ((key === 'ArrowDown' || key === 's') && direction !== 'U') {
      direction = 'D';
    }
  });

  // botón iniciar/reiniciar
  startBtn.addEventListener('click', () => {
    startGame();
  });

  // Arranca el juego en estado no iniciado (esperando que el usuario presione iniciar)
  // muestra frame inicial
  initSnake();
  placeApple();
  draw();
})();
</script>
</body>
</html>
